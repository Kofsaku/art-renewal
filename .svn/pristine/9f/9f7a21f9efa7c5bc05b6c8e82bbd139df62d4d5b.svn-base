package jp.co.art.trident.controller;

import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestMethod;
import org.springframework.web.bind.annotation.ResponseBody;
import jakarta.servlet.http.HttpServletRequest;
import jp.co.art.trident.exception.TridentException;
import jp.co.art.trident.model.ServiceResult;
import jp.co.art.trident.model.form.InitialForm;
import jp.co.art.trident.service.InitialService;
import jp.co.art.trident.service.common.MOperationlogService;

/**初期設定画面のコントローラークラス**/
@Controller
public class InitialController {

	/** 初期設定画面サービスクラス */
	private final InitialService initialService;
	
	/** 操作ログサービスクラス */
	private final MOperationlogService mOperationlogService;	
	
	public InitialController(InitialService initialService
			,MOperationlogService mOperationlogService){			
		this.initialService = initialService;
		this.mOperationlogService = mOperationlogService;
	}
	
	/**
	 * 初期設定画面初期表示処理
	 * 
	 * @param model モデル
	 * @return HTML画面名
	 * @throws TrindentException 
	 */		
	@RequestMapping(value = {"/initial", "/initial/index" })
	public String init(Model model) throws TridentException 
	{
		InitialForm form = initialService.initScreen();	
		model.addAttribute("initialForm", form);
		model.addAttribute("screen", "initial");
		return "initial/index";
	}

	/**
	 * 初期設定画面存在チェック
	 * 
	 * @param initialForm
	 * @return HTML画面名
	 * @throws TrindentException 
	 */	
	@RequestMapping(value = { "/initial/exist"}, method = RequestMethod.POST)
	@ResponseBody
	public ServiceResult<Boolean> exist(@RequestBody InitialForm initialForm
			) throws TridentException 
	{
		return initialService.checkExistenceInitialData();
	}

	/**
	 * 初期設定画面登録処理
	 * 
	 * @param model モデル
	 * @param 　request
	 * @return HTML画面名
	 * @throws TrindentException 
	 */	
	@RequestMapping(value = { "/initial/regist"})
	public String regist(Model model,HttpServletRequest request
			) throws TridentException 
	{
		// 登録後、画面データ再表示
		InitialForm form = new InitialForm();
		// 登録処理
		form = initialService.initialRegist(request);	
		
		model.addAttribute("initialForm", form);
		model.addAttribute("screen", "initial");
		return "initial/index";
	}	

	/**
	 * 詳細設定画面登録処理
	 * 
	 * @param model モデル
	 * @param 　request
	 * @return HTML画面名
	 * @throws TrindentException 
	 */	
	@RequestMapping(value = { "/initial/advancedsettings/regist"})
	public String registAdvancedsettings(Model model,HttpServletRequest request
			) throws TridentException 
	{
		// 登録後、画面データ再表示
		InitialForm form = new InitialForm();
		// 登録処理
		form = initialService.advancedsettingsRegist(request);	
		
		model.addAttribute("initialForm", form);
		model.addAttribute("screen", "initial");
		return "initial/index";
	}	
	
	/**
	 * 操作履歴
	 * 
	 * @param initialForm
	 * @return HTML画面名
	 * @throws TrindentException 
	 */	
	@RequestMapping(value = { "/initial/operate"}, method = RequestMethod.POST)
	@ResponseBody
	public ServiceResult<Boolean> operate(@RequestBody InitialForm initialForm 
			) throws TridentException 
	{	
		boolean bret = mOperationlogService.RegistOperation(initialForm.getOpecode());
		ServiceResult<Boolean> serviceResult = new ServiceResult<Boolean>();
		serviceResult.setSuccess(true);
		serviceResult.setContent(bret);
		return serviceResult;
	}
}
